// koTrackChanges 1.0.0 | (c) 2014 Simon LeVasseur |  http://www.opensource.org/licenses/mit-license
(function(){function a(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function b(a){a.length=0,v.length<x&&v.push(a)}function c(a,b){var c;b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);var d=-1;c=c-b||0;for(var e=Array(0>c?0:c);++d<c;)e[d]=a[b+d];return e}function d(){}function e(a){function b(){if(e){var a=c(e);ab.apply(a,arguments)}if(this instanceof b){var h=g(d.prototype),a=d.apply(h,a||arguments);return q(a)?a:h}return d.apply(f,a||arguments)}var d=a[0],e=a[2],f=a[4];return kb(b,a),b}function f(d,e,g,h,i){if(g){var j=g(d);if("undefined"!=typeof j)return j}if(!q(d))return d;var k=Y.call(d);if(!L[k]||!jb.nodeClass&&a(d))return d;var l=hb[k];switch(k){case E:case F:return new l(+d);case H:case K:return new l(d);case J:return j=l(d.source,y.exec(d)),j.lastIndex=d.lastIndex,j}if(k=lb(d),e){var m=!h;h||(h=v.pop()||[]),i||(i=v.pop()||[]);for(var n=h.length;n--;)if(h[n]==d)return i[n];j=k?l(d.length):{}}else j=k?c(d):qb({},d);return k&&(_.call(d,"index")&&(j.index=d.index),_.call(d,"input")&&(j.input=d.input)),e?(h.push(d),i.push(j),(k?pb:sb)(d,function(a,b){j[b]=f(a,e,g,h,i)}),m&&(b(h),b(i)),j):j}function g(a){return q(a)?eb(a):{}}function h(a,b,c){if("function"!=typeof a)return t;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(jb.funcNames&&(d=!a.name),d=d||!jb.funcDecomp,!d)){var e=$.call(a);jb.funcNames||(d=!z.test(e)),d||(d=A.test(e),kb(a,d))}if(!1===d||!0!==d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return s(a,b)}function i(a){function b(){var a=l?j:this;if(f){var r=c(f);ab.apply(r,arguments)}return(h||n)&&(r||(r=c(arguments)),h&&ab.apply(r,h),n&&r.length<k)?(e|=16,i([d,o?e:-4&e,r,null,j,k])):(r||(r=arguments),m&&(d=a[p]),this instanceof b?(a=g(d.prototype),r=d.apply(a,r),q(r)?r:a):d.apply(a,r))}var d=a[0],e=a[1],f=a[2],h=a[3],j=a[4],k=a[5],l=1&e,m=2&e,n=4&e,o=8&e,p=d;return kb(b,a),b}function j(c,d,e,f,g,h){if(e){var i=e(c,d);if("undefined"!=typeof i)return!!i}if(c===d)return 0!==c||1/c==1/d;if(c===c&&!(c&&O[typeof c]||d&&O[typeof d]))return!1;if(null==c||null==d)return c===d;var k=Y.call(c),l=Y.call(d);if(k==C&&(k=I),l==C&&(l=I),k!=l)return!1;switch(k){case E:case F:return+c==+d;case H:return c!=+c?d!=+d:0==c?1/c==1/d:c==+d;case J:case K:return c==d+""}if(l=k==D,!l){var m=_.call(c,"__wrapped__"),n=_.call(d,"__wrapped__");if(m||n)return j(m?c.__wrapped__:c,n?d.__wrapped__:d,e,f,g,h);if(k!=I||!jb.nodeClass&&(a(c)||a(d)))return!1;if(k=!jb.argsObject&&o(c)?Object:c.constructor,m=!jb.argsObject&&o(d)?Object:d.constructor,k!=m&&!(p(k)&&k instanceof k&&p(m)&&m instanceof m)&&"constructor"in c&&"constructor"in d)return!1}for(k=!g,g||(g=v.pop()||[]),h||(h=v.pop()||[]),m=g.length;m--;)if(g[m]==c)return h[m]==d;var q=0,i=!0;if(g.push(c),h.push(d),l){if(m=c.length,q=d.length,(i=q==m)||f)for(;q--;)if(l=m,n=d[q],f)for(;l--&&!(i=j(c[l],n,e,f,g,h)););else if(!(i=j(c[q],n,e,f,g,h)))break}else rb(d,function(a,b,d){return _.call(d,b)?(q++,i=_.call(c,b)&&j(c[b],a,e,f,g,h)):void 0}),i&&!f&&rb(c,function(a,b,c){return _.call(c,b)?i=-1<--q:void 0});return g.pop(),h.pop(),k&&(b(g),b(h)),i}function l(a,b,d,f,g,h){var j=1&b,k=4&b,m=16&b,n=32&b;if(!(2&b||p(a)))throw new TypeError;m&&!d.length&&(b&=-17,m=d=!1),n&&!f.length&&(b&=-33,n=f=!1);var o=a&&a.__bindData__;return o&&!0!==o?(o=c(o),o[2]&&(o[2]=c(o[2])),o[3]&&(o[3]=c(o[3])),!j||1&o[1]||(o[4]=g),!j&&1&o[1]&&(b|=8),!k||4&o[1]||(o[5]=h),m&&ab.apply(o[2]||(o[2]=[]),d),n&&cb.apply(o[3]||(o[3]=[]),f),o[1]|=b,l.apply(null,o)):(1==b||17===b?e:i)([a,b,d,f,g,h])}function m(){N.h=B,N.b=N.c=N.g=N.i="",N.e="t",N.j=!0;for(var a,b=0;a=arguments[b];b++)for(var c in a)N[c]=a[c];b=N.a,N.d=/^[^,]+/.exec(b)[0],a=Function,b="return function("+b+"){",c=N;var d="var n,t="+c.d+",E="+c.e+";if(!t)return E;"+c.i+";";c.b?(d+="var u=t.length;n=-1;if("+c.b+"){",jb.unindexedChars&&(d+="if(s(t)){t=t.split('')}"),d+="while(++n<u){"+c.g+";}}else{"):jb.nonEnumArgs&&(d+="var u=t.length;n=-1;if(u&&p(t)){while(++n<u){n+='';"+c.g+";}}else{"),jb.enumPrototypes&&(d+="var G=typeof t=='function';"),jb.enumErrorProps&&(d+="var F=t===k||t instanceof Error;");var e=[];if(jb.enumPrototypes&&e.push('!(G&&n=="prototype")'),jb.enumErrorProps&&e.push('!(F&&(n=="message"||n=="name"))'),c.j&&c.f)d+="var C=-1,D=B[typeof t]&&v(t),u=D?D.length:0;while(++C<u){n=D[C];",e.length&&(d+="if("+e.join("&&")+"){"),d+=c.g+";",e.length&&(d+="}"),d+="}";else if(d+="for(n in t){",c.j&&e.push("m.call(t, n)"),e.length&&(d+="if("+e.join("&&")+"){"),d+=c.g+";",e.length&&(d+="}"),d+="}",jb.nonEnumShadows){for(d+="if(t!==A){var i=t.constructor,r=t===(i&&i.prototype),f=t===J?I:t===k?j:L.call(t),x=y[f];",k=0;7>k;k++)d+="n='"+c.h[k]+"';if((!(r&&x[n])&&m.call(t,n))",c.j||(d+="||(!x[n]&&t[n]!==A[n])"),d+="){"+c.g+"}";d+="}"}return(c.b||jb.nonEnumArgs)&&(d+="}"),d+=c.c+";return E",a("d,j,k,m,o,p,q,s,v,A,B,y,I,J,L",b+d+"}")(h,G,V,_,w,o,lb,r,N.f,W,O,ib,K,X,Y)}function n(a){return"function"==typeof a&&Z.test(a)}function o(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Y.call(a)==C||!1}function p(a){return"function"==typeof a}function q(a){return!(!a||!O[typeof a])}function r(a){return"string"==typeof a||a&&"object"==typeof a&&Y.call(a)==K||!1}function s(a,b){return 2<arguments.length?l(a,17,c(arguments,2),null,b):l(a,1,null,null,b)}function t(a){return a}function u(){}var v=[],w={},x=40,y=/\w*$/,z=/^\s*function[ \n\r\t]+\w/,A=/\bthis\b/,B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),C="[object Arguments]",D="[object Array]",E="[object Boolean]",F="[object Date]",G="[object Error]",H="[object Number]",I="[object Object]",J="[object RegExp]",K="[object String]",L={"[object Function]":!1};L[C]=L[D]=L[E]=L[F]=L[H]=L[I]=L[J]=L[K]=!0;var M={configurable:!1,enumerable:!1,value:null,writable:!1},N={a:"",b:null,c:"",d:"",e:"",v:null,g:"",h:null,support:null,i:"",j:!1},O={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},P=O[typeof window]&&window||this,Q=O[typeof exports]&&exports&&!exports.nodeType&&exports,R=O[typeof module]&&module&&!module.nodeType&&module,S=R&&R.exports===Q&&Q,T=O[typeof global]&&global;!T||T.global!==T&&T.window!==T||(P=T);var U=[],V=Error.prototype,W=Object.prototype,X=String.prototype,Y=W.toString,Z=RegExp("^"+(Y+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),$=Function.prototype.toString,_=W.hasOwnProperty,ab=U.push,bb=W.propertyIsEnumerable,cb=U.unshift,db=function(){try{var a={},b=n(b=Object.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),eb=n(eb=Object.create)&&eb,fb=n(fb=Array.isArray)&&fb,gb=n(gb=Object.keys)&&gb,hb={};hb[D]=Array,hb[E]=Boolean,hb[F]=Date,hb["[object Function]"]=Function,hb[I]=Object,hb[H]=Number,hb[J]=RegExp,hb[K]=String;var ib={};ib[D]=ib[F]=ib[H]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ib[E]=ib[K]={constructor:!0,toString:!0,valueOf:!0},ib[G]=ib["[object Function]"]=ib[J]={constructor:!0,toString:!0},ib[I]={constructor:!0},function(){for(var a=B.length;a--;){var b,c=B[a];for(b in ib)_.call(ib,b)&&!_.call(ib[b],c)&&(ib[b][c]=!1)}}();var jb=d.support={};!function(){function a(){this.x=1}var b={0:1,length:1},c=[];a.prototype={valueOf:1,y:1};for(var d in new a)c.push(d);for(d in arguments);jb.argsClass=Y.call(arguments)==C,jb.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),jb.enumErrorProps=bb.call(V,"message")||bb.call(V,"name"),jb.enumPrototypes=bb.call(a,"prototype"),jb.funcDecomp=!n(P.k)&&A.test(function(){return this}),jb.funcNames="string"==typeof Function.name,jb.nonEnumArgs=0!=d,jb.nonEnumShadows=!/valueOf/.test(c),jb.spliceObjects=(U.splice.call(b,0,1),!b[0]),jb.unindexedChars="xx"!="x"[0]+Object("x")[0];try{jb.nodeClass=!(Y.call(document)==I&&!({toString:0}+""))}catch(e){jb.nodeClass=!0}}(1),eb||(g=function(){function a(){}return function(b){if(q(b)){a.prototype=b;var c=new a;a.prototype=null}return c||P.Object()}}());var kb=db?function(a,b){M.value=b,db(a,"__bindData__",M)}:u;jb.argsClass||(o=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&_.call(a,"callee")&&!bb.call(a,"callee")||!1});var lb=fb||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Y.call(a)==D||!1},mb=m({a:"z",e:"[]",i:"if(!(B[typeof z]))return E",g:"E.push(n)"}),T=gb?function(a){return q(a)?jb.enumPrototypes&&"function"==typeof a||jb.nonEnumArgs&&a.length&&o(a)?mb(a):gb(a):[]}:mb,fb={a:"g,e,K",i:"e=e&&typeof K=='undefined'?e:d(e,K,3)",b:"typeof u=='number'",v:T,g:"if(e(t[n],n,g)===false)return E"},nb={a:"z,H,l",i:"var a=arguments,b=0,c=typeof l=='number'?2:a.length;while(++b<c){t=a[b];if(t&&B[typeof t]){",v:T,g:"if(typeof E[n]=='undefined')E[n]=t[n]",c:"}}"},ob={i:"if(!B[typeof t])return E;"+fb.i,b:!1},pb=m(fb),qb=m(nb,{i:nb.i.replace(";",";if(c>3&&typeof a[c-2]=='function'){var e=d(a[--c-1],a[c--],2)}else if(c>2&&typeof a[c-1]=='function'){e=a[--c]}"),g:"E[n]=e?e(E[n],t[n]):t[n]"}),rb=m(fb,ob,{j:!1}),sb=m(fb,ob);p(/x/)&&(p=function(a){return"function"==typeof a&&"[object Function]"==Y.call(a)}),d.assign=qb,d.bind=s,d.forIn=rb,d.forOwn=sb,d.keys=T,d.extend=qb,d.clone=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),f(a,b,"function"==typeof c&&h(c,d,1))},d.identity=t,d.isArguments=o,d.isArray=lb,d.isEqual=function(a,b,c,d){return j(a,b,"function"==typeof c&&h(c,d,2))},d.isFunction=p,d.isObject=q,d.isString=r,d.noop=u,d.VERSION="2.4.1","function"==typeof define&&"object"==typeof define.amd&&define.amd?(P._=d,define(function(){return d})):Q&&R?S?(R.exports=d)._=d:Q._=d:P._=d}).call(this),function(a){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("ko"),require("underscore"),exports):"function"==typeof define&&define.amd?define(["ko","underscore","exports"],a):a(ko,_,ko.trackChanges={})}(function(a,b,c){"use strict";var d=c,e={};d.Group=function(c){var d=[];this.editables=a.observableArray([]),c&&(b.isArray(c)||a.isObservable(c)&&"push"in c||(c=[c]),a.utils.arrayForEach(a.unwrap(c),function(b){a.isObservable(b)&&(b.isDirty||b.extend({trackChanges:!0}),d.push(b))}),this.editables(d)),this.changes=a.computed(this.getChanges,this),this.isDirty=a.computed(this.getIsDirty,this)},d.Group.prototype={getChanges:function(){var b=[];return a.utils.arrayForEach(this.editables(),function(a){a.isDirty()&&b.push(a)}),b},getIsDirty:function(){return this.changes().length>0},commitAll:function(){a.utils.arrayForEach(this.editables(),function(a){a.commit()})},rollbackAll:function(){a.utils.arrayForEach(this.editables(),function(a){a.rollback()})},add:function(c){b.isArray(c)||a.isObservable(c)&&"push"in c||(c=[c]);var d=this.editables;a.utils.arrayForEach(a.unwrap(c),function(b){a.isObservable(b)&&(b.isDirty||b.extend({trackChanges:!0}),d.push(b))})},remove:function(c){b.isArray(c)||a.isObservable(c)&&"push"in c||(c=[c]),this.editables.removeAll(c)},dispose:function(){this.changes.dispose(),this.isDirty.dispose();for(var a in e)e.hasOwnProperty(a)&&e[a]===this&&delete e[a]}},d.getGroup=function(a){return e[a]},a.extenders.trackChanges=function(c,f){return c.oldValue=a.observable(c()),c.isDirty=a.computed(function(){return!f.onlyIf||f.onlyIf&&f.onlyIf.call(c)?!b.isEqual(c(),c.oldValue()):!1}),c.rollback=function(){this(this.oldValue())},c.commit=function(){this.oldValue(this())},("string"==typeof f||f instanceof String)&&(e[f]?e[f].editables.push(c):e[f]=new d.Group([c])),c}});