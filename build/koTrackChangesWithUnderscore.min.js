// koTrackChanges 1.0.0 | (c) 2014 Simon LeVasseur |  http://www.opensource.org/licenses/mit-license
!function(a){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a(window._={})}(function(a){"use strict";function b(a,d,e,g){if(a===d)return 0!==a||1/a==1/d;if(null==a||null==d)return a===d;var h=f.call(a);if(h!=f.call(d))return!1;switch(h){case"[object String]":return a==String(d);case"[object Number]":return a!=+a?d!=+d:0==a?1/a==1/d:a==+d;case"[object Date]":case"[object Boolean]":return+a==+d;case"[object RegExp]":return a.source==d.source&&a.global==d.global&&a.multiline==d.multiline&&a.ignoreCase==d.ignoreCase}if("object"!=typeof a||"object"!=typeof d)return!1;for(var i=e.length;i--;)if(e[i]==a)return g[i]==d;var j=a.constructor,k=d.constructor;if(j!==k&&!(c.isFunction(j)&&j instanceof j&&c.isFunction(k)&&k instanceof k))return!1;e.push(a),g.push(d);var l=0,m=!0;if("[object Array]"==h){if(l=a.length,m=l==d.length)for(;l--&&(m=b(a[l],d[l],e,g)););}else{for(var n in a)if(c.has(a,n)&&(l++,!(m=c.has(d,n)&&b(a[n],d[n],e,g))))break;if(m){for(n in d)if(c.has(d,n)&&!l--)break;m=!l}}return e.pop(),g.pop(),m}var c=a,d=Object.prototype,e=d.hasOwnProperty,f=d.toString,g=Object.keys,h=Array.isArray;c.keys=function(a){if(!c.isObject(a))return[];if(g)return g(a);var b=[];for(var d in a)c.has(a,d)&&b.push(d);return b},c.values=function(a){for(var b=c.keys(a),d=b.length,e=Array(d),f=0;d>f;f++)e[f]=a[b[f]];return e},c.isEqual=function(a,c){return a||c?b(a,c,[],[]):!0},c.isArray=h||function(a){return"[object Array]"===f.call(a)},c.isObject=function(a){return a===Object(a)},c.isFunction=function(a){return"[object Function]"===f.call(a)},"function"!=typeof/./&&(c.isFunction=function(a){return"function"==typeof a}),c.has=function(a,b){return null!=a&&e.call(a,b)}}),function(a){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("ko"),require("underscore"),exports):"function"==typeof define&&define.amd?define(["ko","underscore","exports"],a):a(ko,_,ko.trackChanges={})}(function(a,b,c){"use strict";var d=c,e={};d.Group=function(c){var d=[];this.editables=a.observableArray([]),c&&(b.isArray(c)||a.isObservable(c)&&"push"in c||(c=[c]),a.utils.arrayForEach(a.unwrap(c),function(b){a.isObservable(b)&&(b.isDirty||b.extend({trackChanges:!0}),d.push(b))}),this.editables(d)),this.changes=a.computed(this.getChanges,this),this.isDirty=a.computed(this.getIsDirty,this)},d.Group.prototype={getChanges:function(){var b=[];return a.utils.arrayForEach(this.editables(),function(a){a.isDirty()&&b.push(a)}),b},getIsDirty:function(){return this.changes().length>0},commitAll:function(){a.utils.arrayForEach(this.editables(),function(a){a.commit()})},rollbackAll:function(){a.utils.arrayForEach(this.editables(),function(a){a.rollback()})},add:function(c){b.isArray(c)||a.isObservable(c)&&"push"in c||(c=[c]);var d=this.editables;a.utils.arrayForEach(a.unwrap(c),function(b){a.isObservable(b)&&(b.isDirty||b.extend({trackChanges:!0}),d.push(b))})},remove:function(c){b.isArray(c)||a.isObservable(c)&&"push"in c||(c=[c]),this.editables.removeAll(c)},dispose:function(){this.changes.dispose(),this.isDirty.dispose();for(var a in e)e.hasOwnProperty(a)&&e[a]===this&&delete e[a]}},d.getGroup=function(a){return e[a]},a.extenders.trackChanges=function(c,f){return c.oldValue=a.observable(c()),c.isDirty=a.computed(function(){return!f.onlyIf||f.onlyIf&&f.onlyIf.call(c)?!b.isEqual(c(),c.oldValue()):!1}),c.rollback=function(){this(this.oldValue())},c.commit=function(){this.oldValue(this())},("string"==typeof f||f instanceof String)&&(e[f]?e[f].editables.push(c):e[f]=new d.Group([c])),c}});